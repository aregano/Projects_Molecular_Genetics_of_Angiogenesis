---
title: '"FrozenRetina_Mapping_Features'
author: "Alvaro Regano"
date: "18/01/2022"
output:
  BiocStyle::html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
library(knitr)

knitr::opts_chunk$set(
  echo = TRUE, out.width = "200%", fig.align = "center",fig.width = 16,fig.height = 7,
  message = FALSE, warning = FALSE
)
#knitr::opts_knit$set(root.dir= normalizePath('..'))
#knitr::opts_chunk$set(error = FALSE)
options(width = 9000)

```


```{r library, echo=FALSE}
library(Seurat)
library(ggplot2)
library("knitr")
library("rmarkdown")
library("yaml")
library("patchwork")
library("dittoSeq")
library("magick")
library("RColorBrewer")
```

# Objective

I will produce the starndard plots for a quick overview of the Retina dataset.


##	Global UMAP showing the different Clusters

```{r rds, fig.asp=0.8, echo=FALSE}



Retina <- readRDS("../rds/FrozenRetina.ECs.Alvaro.rds")

DefaultAssay(Retina) <- "RNA"



```


```{r carlos, fig.asp=0.8, echo=FALSE}

my_palette_Rui_colors <- c("#E95A74", "#50B6EF", "#45FF8E", "#F4A753", "#A80519", "#880088", "#E28CF4", "#C1B80C","#FC0808",  "#0E47D8")

custom_rdylblu_palette <- c("#005AD9", "#0070FF", "#FFE135", "#FFDA13", "#E60026", "#C60012")

BYG <- c("#0000FF", "#3838C6", "#71718D", "#AAAA55", "#E2E21C", "#FFE200", "#FFAA00", "#FF7100", "#FF3800", "#FF0000")

Bestholtz_palette <- c("#DEDAD6", "#FEE392", "#FEC44E", "#FE9929", "#ED6F11", "#CC4C17", "#993411", "#65260C")

rui_palette <- c( "#D0C9D7", "#71718D", "#AAAA55", "#E2E21C", "#FFE200", "#FFAA00", "#FF7100", "#FF3800", "#FF0000")

DefaultAssay(Retina) <- "RNA"

DimPlot(Retina, pt.size = 2, label = T, label.size = 10, label.box = TRUE, cols = my_palette_Rui_colors)+ NoAxes() + NoLegend()


```

## Global UMAP by Conditions

```{r carlos4, fig.asp=0.8, echo=FALSE}

DimPlot(Retina, group.by = "Condition", pt.size = 2, label = T,label.box = TRUE, label.size = 8, repel = T)+ NoAxes()+ NoLegend()

```


```{r carlos3, fig.height=5, fig.width=20, echo=FALSE}

DimPlot(Retina, split.by = "Condition", pt.size = 1.2, cols = my_palette_Rui_colors)+ NoAxes()
```



## Features Plots of the 6 Conditions splitted up.


```{r f, fig.width=20, fig.height= 80, echo=FALSE}

genes <- list(c("Odc1", "Kcne3", "Mki67", "Wnt2", "Msr1", "Ltbp4", "Rspo3", "Gja5", "Cdkn1a", "Stmn1", "Vegfa", "Esm1", "Hes1", "Dll4", "Myc", "tdTomato-WPRE-sv40pA", "CreERT2-BghpA", "EGFP"))
genes <- as.data.frame(genes)


#  Script

myplots <- vector('list', nrow(genes))


for (i in 1:nrow(genes)) {
  
  p21 <- FeaturePlot(Retina, pt.size = 1.3, features = genes[i, 1], combine = F)

  p22 <- FeaturePlot(Retina, split.by = "Condition", features = genes[i, 1], combine = F)

  p21 <- lapply(X = p21, FUN = function(p) p + NoAxes()+  scale_colour_gradientn(colours = rui_palette))

  p22 <- lapply(X = p22, FUN = function(p) p + NoLegend() + NoAxes()+  scale_colour_gradientn(colours = rui_palette))

  p21 <- Reduce( `+`, p21 )+patchwork::plot_layout( ncol = 1 )

  p22 <- Reduce( `+`, p22 )+patchwork::plot_layout( ncol = 3 )

  p23 <- list(p21, p22)


  design <- c(patchwork::area(1, 1, 1, 1), patchwork::area(1, 2, 1, 4))

  p24 <- Reduce( `+`,  p23)+patchwork::plot_layout(design = design)

  
  myplots[[i]] <- local({
    i <- i
    p24
  })
  
  
}

p25 <- patchwork::wrap_plots(myplots, ncol = 1)

#myplots[1:nrow(genes)] + patchwork::plot_layout(byrow = T, widths = 25, heights = 5)
p25


# p25 <- CombinePlots(plots = myplots, ncol = 1)
# p25

```


##	Barplots

```{r b, fig.height=10, fig.width=8, echo=FALSE}

dittoBarPlot(Retina, var = "RNA_snn_res.0.3", group.by = "Condition", color.panel = my_palette_Rui_colors, xlab = NULL, main = NULL)+ theme(axis.text=element_text(size=18), axis.title = element_text(size = 20), legend.text = element_text(size = 16))

```

```{r b2, fig.height=10, fig.width=8, echo=FALSE}

dittoBarPlot(Retina, var = "RNA_snn_res.0.3", group.by = "Condition", scale = "count", color.panel = my_palette_Rui_colors, xlab = NULL, main = NULL)+ theme(axis.text=element_text(size=18), axis.title = element_text(size = 20), legend.text = element_text(size = 16))

```


```{r barplot, fig.height=10, fig.width=4, echo=FALSE}

dittoBarPlot(Retina, var = "RNA_snn_res.0.3", group.by = "orig.ident", scale = "count", color.panel = my_palette_Rui_colors, xlab = NULL, main = NULL)+ theme(axis.text=element_text(size=8), axis.title = element_text(size = 10), legend.text = element_text(size = 6))

```
